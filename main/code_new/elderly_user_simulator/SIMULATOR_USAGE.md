# 用户模拟器使用说明（简化版）

## 📋 功能说明

本简化版实现了两种交互模式：
1. **真实用户模式**：用户从终端输入，与助手对话（已实现）
2. **模拟用户模式**：模拟老年人用户自动生成对话，与助手对话（新增）

## 🔧 配置方法

### 1. 环境变量配置

在 `.env` 文件中添加：

```env
# 交互模式：real_user（真实用户）或 simulated_user（模拟用户）
INTERACTION_MODE=simulated_user

# 可选：指定配置文件路径（如果不指定，使用默认路径）
ELDERLY_USER_CONFIG=main/code_new/elderly_user_simulator/elderly_user_simulator_config.json
```

### 2. 用户模拟器配置文件

配置文件：`elderly_user_simulator/elderly_user_simulator_config.json`

```json
{
  "elderly_user_prompt": "你是一个68岁的老年女性，来自石家庄...",
  "llm_config": {
    "model": "qwen-turbo",
    "temperature": 0.7
  }
}
```

**配置说明**：
- `elderly_user_prompt`：模拟老年人的提示词描述，用于指导LLM生成符合老年人特点的对话
- `llm_config`：LLM配置
  - `model`：使用的模型名称（默认：qwen-turbo）
  - `temperature`：生成温度（默认：0.7）

## 🚀 使用方法

### 模式1：真实用户模式（默认）

```bash
# 在 .env 文件中设置（或不设置，默认就是真实用户模式）
INTERACTION_MODE=real_user

# 运行程序
python main/code_new/agent.py
```

**使用流程**：
1. 输入用户ID（或使用默认）
2. 直接输入对话内容
3. 系统提取画像并生成个性化回答
4. 输入 `exit` 退出

### 模式2：模拟用户模式

```bash
# 在 .env 文件中设置
INTERACTION_MODE=simulated_user

# 运行程序
python main/code_new/agent.py
```

**使用流程**：
1. 输入用户ID（或使用默认）
2. 按回车键开始对话
3. 系统自动生成用户消息和助手回复
4. 每轮对话后询问是否继续
5. 输入 `y` 继续，输入 `n` 或 `exit` 退出

## 📝 示例

### 模拟用户模式示例

```
============================================================
用户画像记忆系统
============================================================

[INFO] 正在初始化 memU 存储层...
[OK] memU 存储层初始化成功

请输入用户ID（直接回车使用默认 'default_user'）: test_user
[INFO] 当前用户ID: test_user

[INFO] 正在加载历史画像...
[INFO] 新用户，已初始化空画像（优化版）

[INFO] 正在初始化 Memory...
[OK] Memory 初始化成功

[INFO] 正在初始化个性化回答生成器...
[OK] 个性化回答生成器初始化成功

[INFO] 正在初始化用户模拟器...
[OK] 用户模拟器初始化成功

============================================================
对话系统已启动
============================================================

模式：模拟用户模式
  - 模拟老年人用户将自动生成对话
  - 系统会提取并更新用户画像
  - 系统会根据用户画像生成个性化回答
  - 每轮对话后会询问是否继续

------------------------------------------------------------

按回车键开始对话...

开始对话...

--- 第 1 轮对话 ---

[INFO] 正在生成用户消息...
用户: 你好，我最近有点失眠，睡不好觉

[INFO] 正在提取画像信息...
[OK] 画像提取完成

[INFO] 正在生成个性化回答...
助手: 您好！我理解您最近睡眠不好的困扰。对于您来说，保持良好的睡眠质量非常重要...

------------------------------------------------------------
是否继续对话？(y/n，或输入 'exit' 退出): y

--- 第 2 轮对话 ---

[INFO] 正在生成用户消息...
用户: 我今年68岁了，平时一个人住

[INFO] 正在提取画像信息...
[OK] 画像提取完成

[INFO] 正在生成个性化回答...
助手: 我了解您的情况。作为一位68岁的独居老人...

------------------------------------------------------------
是否继续对话？(y/n，或输入 'exit' 退出): n

[INFO] 正在保存数据...
[OK] 数据已保存

对话已结束，再见！
```

## ⚙️ 自定义配置

### 修改模拟用户提示词

编辑 `elderly_user_simulator/elderly_user_simulator_config.json` 文件中的 `elderly_user_prompt` 字段：

```json
{
  "elderly_user_prompt": "你是一个70岁的老年男性，来自北京，退休教师。你的语言特点：\n- 说话比较正式，但也很亲切\n- 喜欢分享生活经验\n- 关注健康、教育、社会话题\n\n请根据对话历史，生成下一轮用户对话。要求：\n1. 符合老年人的语言特点\n2. 自然、真实、有感情\n3. 对话长度适中（1-3句话）\n4. 与对话历史连贯"
}
```

### 修改LLM配置

```json
{
  "llm_config": {
    "model": "qwen-plus",
    "temperature": 0.8
  }
}
```

## ⚠️ 注意事项

1. **API Key**：确保 `.env` 文件中配置了 `DASHSCOPE_API_KEY`
2. **依赖**：需要安装 `dashscope` 或 `langchain` 和 `langchain-community`
3. **配置文件**：配置文件必须是有效的JSON格式
4. **模式切换**：修改 `.env` 文件后需要重启程序

## 🔄 后续扩展

当前是简化版本，后续可以根据 `ELDERLY_USER_SIMULATOR_PLAN.md` 文档继续扩展：
- 添加轨迹生成器
- 添加语言风格生成器
- 添加画像配置系统
- 添加评估系统

---

**创建时间**: 2026-01-28  
**版本**: v1.0（简化版）


